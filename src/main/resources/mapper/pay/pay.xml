<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pcwk.miss.pay">

	<!-- 포인트 조회 -->
	<select id="pointValue" parameterType="MemberVO" resultType="int">
		SELECT mb_point AS "mbPoint"
		FROM member
		WHERE mb_num = #{mbNum}

	</select>

	<!-- 할인 쿠폰 리스트 -->
	<select id="couponRetrieve" parameterType="CouponVO" resultType="CouponVO">
		SELECT c_num AS "cNum",
	       c_name AS "cName",
	       c_period AS "cPeriod",
	       c_ratio AS "cRatio"
		FROM coupon
		WHERE mb_num = #{mbNum} AND c_kind IS NOT NULL
	</select>
	
	<delete id="couponDelete" parameterType="CouponVO">
		DELETE FROM coupon
		WHERE c_num = #{cNum}
	</delete>
	
	<!-- 예매 내역 insert -->
	<insert id="ticketInsert" parameterType="TicketVO">
		INSERT INTO ticket (
	    t_num,
	    mb_num,
	    t_price,
	    t_means,
	    t_time,
	    t_status,
	    mv_num
	) VALUES (
	    #{tNum},
	    1,
	    #{tPrice},
	    #{tMeans},
	    SYSDATE,
	    #{tStatus} ,
	    #{mvNum} 
	)
	
	</insert>

	<!-- 예매페이지  상영중인 영화 -->
	<select id="getMovieOn" resultType="ReserveVO">
		SELECT MV_NUM AS mvNum,
		    MV_TITLE AS mvTitle
		FROM MOVIE
		WHERE MV_ON = 1
	</select>
	
	<!-- 예매페이지 상영시간 조회 -->
	<select id="getMovieTime" parameterType="ReserveVO" resultType="ReserveVO">
		SELECT T1.MV_NUM AS mvNum,
		    T2.MI_TIME AS miTime,
		    T2.MI_QUALITY AS miQuality
		FROM MOVIE T1, MOVIE_INFO T2
		WHERE T1.MV_NUM = T2.MV_NUM
		AND T1.MV_NUM = #{mvNum}
		AND T2.MI_QUALITY LIKE #{miQuality} || '%'
	</select>
</mapper>

